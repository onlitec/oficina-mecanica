<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <title>üë• Clientes - Mobile</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }
        
        /* Header */
        .mobile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 16px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .add-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
        }
        
        /* Main Content */
        .main-content {
            margin-top: 60px;
            padding: 16px;
            padding-bottom: 80px;
        }
        
        /* Search Bar */
        .search-bar {
            background: white;
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .search-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 16px;
            background: transparent;
        }
        
        .search-icon {
            color: #666;
            font-size: 18px;
        }
        
        /* Customer Cards */
        .customers-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .customer-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .customer-card:active {
            transform: scale(0.98);
        }
        
        .customer-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .customer-name {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }
        
        .customer-type {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .type-individual {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .type-company {
            background: #fff3cd;
            color: #856404;
        }
        
        .customer-contact {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-bottom: 12px;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
        }
        
        .contact-icon {
            width: 16px;
            text-align: center;
        }
        
        .customer-vehicles {
            margin-bottom: 12px;
        }
        
        .vehicles-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
        }
        
        .vehicle-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 4px;
            font-size: 14px;
            color: #333;
        }
        
        .customer-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #999;
        }
        
        .customer-date {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .customer-orders {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            z-index: 1000;
        }
        
        .nav-item {
            flex: 1;
            padding: 8px 4px;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s ease;
            text-decoration: none;
            color: inherit;
        }
        
        .nav-item:active {
            background: #f0f0f0;
        }
        
        .nav-item.active {
            color: #667eea;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
            display: block;
        }
        
        .nav-label {
            font-size: 10px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="mobile-header">
        <div class="header-left">
            <button class="back-btn" onclick="goBack()">‚Üê</button>
            <div class="header-title">üë• Clientes</div>
        </div>
        <button class="add-btn" onclick="addCustomer()">+</button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Search Bar -->
        <div class="search-bar">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" placeholder="Buscar clientes..." id="searchInput" oninput="filterCustomers()">
        </div>

        <!-- Customers List -->
        <div class="customers-list" id="customersList">
            <div class="loading">
                <span class="loading-spinner"></span>
                Carregando clientes...
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <a href="/mobile.html" class="nav-item">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">In√≠cio</span>
        </a>
        <a href="/mobile-orders.html" class="nav-item">
            <span class="nav-icon">üìã</span>
            <span class="nav-label">Ordens</span>
        </a>
        <a href="/mobile-customers.html" class="nav-item active">
            <span class="nav-icon">üë•</span>
            <span class="nav-label">Clientes</span>
        </a>
        <a href="/mobile-parts.html" class="nav-item">
            <span class="nav-icon">üì¶</span>
            <span class="nav-label">Pe√ßas</span>
        </a>
        <a href="/mobile-financial.html" class="nav-item">
            <span class="nav-icon">üí∞</span>
            <span class="nav-label">Financeiro</span>
        </a>
    </div>

    <script>
        let allCustomers = [];
        let filteredCustomers = [];

        // Navigation
        function goBack() {
            window.history.back();
        }

        function addCustomer() {
            window.location.href = '/mobile-customer-form.html';
        }

        // Load customers
        async function loadCustomers() {
            try {
                const response = await fetch('/api/customers?limit=50');
                const data = await response.json();

                if (data.success) {
                    allCustomers = data.data;
                    filteredCustomers = [...allCustomers];
                    displayCustomers();
                } else {
                    showError('Erro ao carregar clientes');
                }
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
                showError('Erro de conex√£o');
            }
        }

        // Display customers
        function displayCustomers() {
            const container = document.getElementById('customersList');

            if (filteredCustomers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üë•</div>
                        <div>Nenhum cliente encontrado</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredCustomers.map(customer => `
                <div class="customer-card" onclick="viewCustomer('${customer.id}')">
                    <div class="customer-header">
                        <div>
                            <div class="customer-name">${customer.name}</div>
                        </div>
                        <div class="customer-type type-${customer.type.toLowerCase()}">${getTypeLabel(customer.type)}</div>
                    </div>
                    <div class="customer-contact">
                        ${customer.phone ? `
                        <div class="contact-item">
                            <span class="contact-icon">üìû</span>
                            <span>${customer.phone}</span>
                        </div>
                        ` : ''}
                        ${customer.email ? `
                        <div class="contact-item">
                            <span class="contact-icon">üìß</span>
                            <span>${customer.email}</span>
                        </div>
                        ` : ''}
                        ${customer.cpfCnpj ? `
                        <div class="contact-item">
                            <span class="contact-icon">üìÑ</span>
                            <span>${formatDocument(customer.cpfCnpj)}</span>
                        </div>
                        ` : ''}
                    </div>
                    ${customer.vehicles && customer.vehicles.length > 0 ? `
                    <div class="customer-vehicles">
                        <div class="vehicles-title">Ve√≠culos:</div>
                        ${customer.vehicles.slice(0, 2).map(vehicle => `
                            <div class="vehicle-item">üöó ${vehicle.brand} ${vehicle.model} (${vehicle.plate})</div>
                        `).join('')}
                        ${customer.vehicles.length > 2 ? `<div class="vehicle-item">+${customer.vehicles.length - 2} mais...</div>` : ''}
                    </div>
                    ` : ''}
                    <div class="customer-footer">
                        <div class="customer-date">
                            üìÖ ${formatDate(customer.createdAt)}
                        </div>
                        <div class="customer-orders">${customer._count?.serviceOrders || 0} OS</div>
                    </div>
                </div>
            `).join('');
        }

        // Filter customers
        function filterCustomers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            filteredCustomers = allCustomers.filter(customer => {
                return !searchTerm || 
                    customer.name.toLowerCase().includes(searchTerm) ||
                    (customer.email || '').toLowerCase().includes(searchTerm) ||
                    (customer.phone || '').toLowerCase().includes(searchTerm) ||
                    (customer.cpfCnpj || '').toLowerCase().includes(searchTerm);
            });

            displayCustomers();
        }

        // View customer
        function viewCustomer(customerId) {
            window.location.href = `/mobile-customer-view.html?id=${customerId}`;
        }

        // Helper functions
        function getTypeLabel(type) {
            const labels = {
                'INDIVIDUAL': 'Pessoa F√≠sica',
                'COMPANY': 'Pessoa Jur√≠dica'
            };
            return labels[type] || type;
        }

        function formatDocument(doc) {
            if (!doc) return '';
            
            // Remove non-digits
            const digits = doc.replace(/\D/g, '');
            
            if (digits.length === 11) {
                // CPF
                return digits.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            } else if (digits.length === 14) {
                // CNPJ
                return digits.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
            }
            
            return doc;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now.getTime() - date.getTime();
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Hoje';
            if (diffDays === 1) return 'Ontem';
            if (diffDays < 30) return `${diffDays} dias atr√°s`;
            
            return date.toLocaleDateString('pt-BR');
        }

        function showError(message) {
            document.getElementById('customersList').innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">‚ö†Ô∏è</div>
                    <div>${message}</div>
                </div>
            `;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadCustomers();
        });
    </script>
</body>
</html>
